<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rainsunset.demo.dal.mapper.RecordMapper">

    <sql id="record">
        `record_id` `recordId`,
        `user_id` `userId`, `num` `num`
    </sql>

    <select id="selectRecordList" resultType="com.rainsunset.demo.dal.model.Record">
        SELECT
        <include refid="record"/>
        FROM record
        WHERE `status` = 'VALID'
        <if test="userId != null and userId != ''">
            AND `user_id` = #{userId}
        </if>
        <if test="num != null">
            AND `num` = #{num}
        </if>
        ORDER BY record_id ASC
    </select>

    <select id="getRecordDetail" parameterType="java.lang.Integer"
            resultType="com.rainsunset.demo.dal.model.Record">
        SELECT
        <include refid="record"/>
        FROM record
        WHERE record_id = #{recordId}
    </select>

    <insert id="fullInsertRecord" parameterType="com.rainsunset.demo.dal.model.Record"
        useGeneratedKeys="true" keyProperty="recordId">
        INSERT INTO record ( 
            `user_id`, `num`
        ) VALUES ( 
            #{userId}, #{num}
        )
    </insert>

    <update id="updateRecord" parameterType="com.rainsunset.demo.dal.model.Record">
        UPDATE record
        <trim prefix="set" suffixOverrides=",">
                <if test="userId != null">
                    `user_id` = #{userId},
                </if>
                <if test="num != null">
                    `num` = #{num},
                </if>
        </trim>
        WHERE record_id = #{recordId}
    </update>

    <update id="deleteRecords">
        UPDATE record
        SET `status` = 'UNVALID', updated_by = #{updatedBy}
        WHERE record_id IN
        <foreach collection="recordIds" item="recordId" open="(" close=")" separator=",">
            #{recordId}
        </foreach>
    </update>
</mapper>
